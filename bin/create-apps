#!/bin/bash

set -e

create_app() {
  declare name="$1"
  echo "Create $name application"
  curl -H "Content-Type: application/json" \
    -d "@marathon/${name}.json" http://192.168.99.100:8080/v2/apps \
    &> /dev/null
}

ping_wait() {
  declare hn="$1"
  echo "Waiting for $hn"
  while ! ping -c1 "$hn" &>/dev/null; do
    echo -n "."
    sleep 1
  done
  echo ""
}

create_app dns
create_app zookeeper
ping_wait "zookeeper.marathon.mesos"
create_app kafka
create_app api
create_app namenode
ping_wait "namenode.marathon.mesos"
create_app datanode
create_app flume
create_app elasticsearch
create_app serving
