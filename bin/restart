#!/bin/bash

set -e

source $(dirname $0)/functions.sh

main() {
  declare name="$1"
  case "$name" in
    serving)
      sbt "$name/docker:publishLocal"
      destroy_app "$name"
      sleep 1
      create_app "$name"
      ;;
    api)
      sbt "$name/docker:publishLocal"
      destroy_app "$name"
      sleep 1
      create_app "$name"
      ;;
    algo)
      sbt "$name/assembly"
      sbt "$name/docker:publishLocal"
      destroy_job count
      destroy_job user
      destroy_job similarity
      sleep 1
      create_job count
      create_job user
      create_job similarity
      ;;
    *)
      echo "No such command: $name"
      echo "Usage:"
      echo "  serving"
      echo "  api"
      echo "  algo"
      exit 1
  esac
}

[[ "$0" == "$BASH_SOURCE" ]] && main "$@"
